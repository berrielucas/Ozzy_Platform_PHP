import{a as j,u as ie,d as V,o as W,e as J,r as a,b as c,f as $,q as F,v as H,i as r,c as _,w as o,h as t,l as b,j as u,F as Z,s as G,g as S,t as w,_ as ne,x as de,m as re,p as ce,n as ue}from"./index-CyU7WMZp.js";import{_ as ve,a as pe}from"./ToggleMenu-Ge7VitD_.js";const me=u("p",{class:"font-weight-bold text-center"},"Acessar",-1),_e={key:0,class:"ml-1 mb-2 font-weight-medium",style:{color:"var(--primary-color)"}},fe=u("h4",{class:"ml-1 mb-2"},"Informações do Cliente:",-1),ye={class:"w-100 py-2 px-4"},ge=u("p",{class:"text-center"},"Nenhum cliente encontardo",-1),he={class:"w-100 py-2 px-4"},xe=u("p",{class:"text-center"},"Nenhum pet encontardo",-1),Ve=u("div",{class:"w-100 py-2 px-4"},[u("p",{class:"text-center"},"Nenhum serviço encontardo")],-1),be={key:0,class:"ml-1",style:{"font-size":"13px","font-weight":"600",color:"orange"}},we=u("h4",{class:"ml-1 mb-1 mt-2"},"Escolha o melhor horário:",-1),ke={key:1,class:"ml-1 mb-2 font-weight-light opacity-50"},M={__name:"NewVisit",props:{edit:{type:Boolean,required:!1},id:{type:Number,required:!1}},setup(k){const d=j(),v=ie(),O=["08:00","09:00","10:00","11:00","13:00","14:00","15:00","16:00"],C=V([]),x=V(!1);W(()=>{d.userLogado.type==="client"&&(e.value.idCliente=d.userLogado.idCliente)});const p=k,g=p.edit?JSON.stringify(d.visitas.filter(i=>i.idVisita===p.id)[0]):JSON.stringify({data:"",concluido:!1,total:0,idAnimal:null,idCliente:null,servicos:[]}),e=V(JSON.parse(g)),N=V(p.edit?`R$ ${e.value.total}`.replace(".",","):"R$ 0,00"),L=J(()=>{let i=0;e.value.servicos.length>0&&e.value.servicos.forEach(f=>{i+=parseFloat(f.preco)});const{preco:l,display:D}=d.formatMoeda(`${i.toFixed(2)}`);e.value.total=l,N.value=D,p.edit&&(e.value.servicosRemovidos=JSON.parse(g).servicos.filter(f=>!e.value.servicos.some(n=>n.idServico==f.idServico)),e.value.servicosAdicionados=e.value.servicos.filter(f=>!JSON.parse(g).servicos.some(n=>n.idServico==f.idServico)))}),T=J(()=>e.value.servicos.length>=3?e.value.servicos:d.servicos),h=V(p.edit?new Date(e.value.data):null),y=V(p.edit?e.value.data.split(" ")[1].replace(":00",""):null),z=J(()=>{if(console.log("ativou"),h.value===null&&(y.value=null),h.value!==null){const i=new Date(h.value);JSON.parse(g).data.includes(i.toISOString().split("T")[0])&&e.value.data.includes("00:00:00")?(e.value.data=JSON.parse(g).data,y.value=e.value.data.split(" ")[1].replace(":00","")):e.value.data.includes(i.toISOString().split("T")[0])||(y.value=null,e.value.data=new Date(`${i.toISOString().split("T")[0]}T00:00:00.000Z`).toISOString().slice(0,19).replace("T"," "))}!p.edit&&d.visitas.filter(i=>i.data.includes(e.value.data.split(" ")[0])).length>0?C.value=O.filter(i=>d.visitas.filter(l=>l.data.includes(e.value.data.split(" ")[0])).some(l=>!l.data.includes(i))):C.value=O});function R(i){const l=e.value.data.split(" ");y.value!=i?(e.value.data=l[0]+` ${i}:00`,y.value=i):(e.value.data=l[0]+" 00:00:00",y.value=null)}function B(){p.edit?d.atualizarVisita(e.value):d.cadastrarVisita(e.value),x.value=!1,e.value=JSON.parse(g)}function I(){e.value.concluido?(e.value.concluido=!1,d.atualizarVisita(e.value,null,!1)):(e.value.concluido=!0,d.atualizarVisita(e.value,null,!1))}function A(i){x.value=!1,v.push({name:`${i}`})}function P(){e.value.idAnimal!==null&&d.pets.filter(i=>i.idCliente===e.value.idCliente&&i.idAnimal===e.value.idAnimal).length==0&&(e.value.idAnimal=null)}return(i,l)=>{const D=a("v-list-item"),f=a("v-btn"),n=a("v-date-picker"),m=a("v-col"),q=a("v-row"),E=a("v-autocomplete"),K=a("v-text-field"),Q=a("v-chip"),X=a("v-chip-group"),Y=a("v-card-text"),ee=a("v-divider"),te=a("v-spacer"),le=a("v-card-actions"),oe=a("v-card"),ae=a("v-dialog");return c(),$("div",null,[p.edit?F((c(),_(D,{key:0,density:"compact",onClick:l[0]||(l[0]=s=>x.value=!0)},{default:o(()=>[me]),_:1},512)),[[H,!r(d).loadVisitas]]):(c(),_(f,{key:1,onClick:l[1]||(l[1]=s=>x.value=!0),class:"text-none ml-4",variant:"elevated",text:"Novo Agendamento",style:{"background-color":"var(--primary-color)",color:"white","border-radius":"10px","font-size":"medium"}})),t(ae,{modelValue:x.value,"onUpdate:modelValue":l[14]||(l[14]=s=>x.value=s),width:"auto",persistent:""},{default:o(()=>[t(oe,{"prepend-icon":"mdi-calendar",title:p.edit?"Agendamento":"Novo Agendamento",width:"1100"},{append:o(()=>[e.value.concluido?(c(),$("h4",_e,"Agendamento concluído")):b("",!0)]),default:o(()=>[t(Y,{class:"px-4 pb-3"},{default:o(()=>[t(q,{dense:""},{default:o(()=>[t(m,{cols:"12",md:"4",sm:"6"},{default:o(()=>[t(q,{dense:""},{default:o(()=>[t(m,{cols:"12"},{default:o(()=>[t(n,{disabled:e.value.concluido,modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=s=>h.value=s),update:z.value,"onUpdate:update":l[3]||(l[3]=s=>z.value=s),class:"w-100 border",color:"var(--primary-color)","hide-header":"",min:new Date},null,8,["disabled","modelValue","update","min"])]),_:1})]),_:1})]),_:1}),t(m,{cols:"8"},{default:o(()=>[t(q,{dense:""},{default:o(()=>[t(m,{cols:"12",class:"d-flex justify-space-between"},{default:o(()=>[fe]),_:1}),r(d).userLogado.type==="user"?(c(),_(m,{key:0,cols:"6"},{default:o(()=>[t(E,{modelValue:e.value.idCliente,"onUpdate:modelValue":l[5]||(l[5]=s=>e.value.idCliente=s),items:r(d).clientes,label:"Cliente *","item-title":"nome","item-value":"idCliente","on-update:model-value":P(),required:"",clearable:"",disabled:e.value.concluido},{"no-data":o(()=>[u("div",ye,[ge,t(f,{onClick:l[4]||(l[4]=s=>A("clientes")),class:"text-none w-100 mt-3",variant:"tonal",color:"var(--primary-color)",text:"Adicionar Cliente"})])]),_:1},8,["modelValue","items","on-update:model-value","disabled"])]),_:1})):b("",!0),t(m,{cols:r(d).userLogado.type==="user"?"6":"12"},{default:o(()=>[t(E,{disabled:!(e.value.idCliente!==null&&e.value.idCliente!=="")||e.value.concluido,modelValue:e.value.idAnimal,"onUpdate:modelValue":l[7]||(l[7]=s=>e.value.idAnimal=s),items:r(d).pets.filter(s=>s.idCliente===e.value.idCliente),label:"Pet *","item-title":"nome","item-value":"idAnimal",required:"",clearable:""},{"no-data":o(()=>[u("div",he,[xe,t(f,{onClick:l[6]||(l[6]=s=>A(r(d).userLogado.type!=="client"?"pets":"pets-cliente")),class:"text-none w-100 mt-3",variant:"tonal",color:"var(--primary-color)",text:"Adicionar Pet"})])]),_:1},8,["disabled","modelValue","items"])]),_:1},8,["cols"]),t(m,{cols:"9"},{default:o(()=>[t(E,{disabled:e.value.concluido,label:"Serviços *",modelValue:e.value.servicos,"onUpdate:modelValue":l[8]||(l[8]=s=>e.value.servicos=s),items:T.value,"on-update:model-value":L.value,"item-title":"nome","return-object":"",multiple:"",chips:"","closable-chips":"","auto-select-first":"","hide-details":""},{"no-data":o(()=>[Ve]),_:1},8,["disabled","modelValue","items","on-update:model-value"]),e.value.servicos.length>=3?(c(),$("p",be,"Você atingiu o limite de serviço por agendamento")):b("",!0)]),_:1}),t(m,{cols:"3"},{default:o(()=>[t(K,{label:"Valor Total (R$)",disabled:"",modelValue:N.value,"onUpdate:modelValue":l[9]||(l[9]=s=>N.value=s)},null,8,["modelValue"])]),_:1}),t(m,{cols:"12"},{default:o(()=>[we]),_:1}),t(m,{cols:"12"},{default:o(()=>[C.value.length>0?(c(),_(X,{key:0,disabled:h.value===null||e.value.concluido,modelValue:y.value,"onUpdate:modelValue":l[10]||(l[10]=s=>y.value=s),color:"var(--primary-color)"},{default:o(()=>[(c(!0),$(Z,null,G(C.value,(s,se)=>(c(),_(Q,{value:s,onClick:Je=>R(s),key:se},{default:o(()=>[S(w(s),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["disabled","modelValue"])):(c(),$("h4",ke,"Sem horários disponíveis para essa data"))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(ee),t(le,{class:"px-4"},{default:o(()=>[p.edit&&r(d).userLogado.type==="user"?(c(),_(f,{key:0,onClick:l[11]||(l[11]=s=>I()),class:"text-none border pl-3",color:e.value.concluido?"yellow":"var(--primary-color)","prepend-icon":e.value.concluido?"mdi-alert-circle-outline":"mdi-check",variant:"text"},{default:o(()=>[S(w(e.value.concluido?"Reabrir":"Concluir Agenda"),1)]),_:1},8,["color","prepend-icon"])):b("",!0),t(te),t(f,{onClick:l[12]||(l[12]=s=>{x.value=!1,e.value=JSON.parse(r(g)),h.value=null,y.value=null}),class:"text-none",text:"Cancelar",variant:"plain"}),t(f,{onClick:l[13]||(l[13]=s=>B()),class:"text-none",color:"var(--primary-color)",text:"Salvar",variant:"tonal"})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])])}}},U=k=>(ce("data-v-ee03c435"),k=k(),ue(),k),Ce={style:{display:"flex","font-weight":"500","font-size":"20px"}},$e=U(()=>u("div",{class:"pt-15 py-4 w-100 text-center"},[u("h3",{class:"font-weight-medium opacity-80"},"Nenhuma visita agendada")],-1)),Se={class:"text-medium-emphasis font-weight-bold"},Ne={class:"py-2"},Ae={class:"text-h6"},De={class:"font-weight-light text-medium-emphasis"},Oe=U(()=>u("strong",null,"Cliente:",-1)),Le={class:"px-3 py-2 d-flex align-center"},Te=U(()=>u("p",{class:"font-weight-bold"},"Reabrir",-1)),ze=U(()=>u("p",{class:"font-weight-bold"},"Excluir",-1)),Ie={__name:"VisitasView",setup(k){const d=de(),v=j();W(()=>{v.listarVisitas()});const O=V("");V(1);const C=V(10);J(()=>Math.ceil(v.servicos.length/C.value));function x(p){return`${d.format(new Date(p),"fullDateWithWeekday")}, ${d.format(new Date(p),"fullTime24h").split(":")[0]}:${d.format(new Date(p),"fullTime24h").split(":")[1]}`}return(p,g)=>{const e=a("v-app-bar"),N=a("v-progress-linear"),L=a("v-row"),T=a("v-icon"),h=a("v-spacer"),y=a("v-card-title"),z=a("v-card-item"),R=a("v-divider"),B=a("v-chip"),I=a("v-btn"),A=a("v-list-item"),P=a("v-list"),i=a("v-menu"),l=a("v-card"),D=a("v-col"),f=a("v-main");return c(),_(f,{style:{padding:"0",margin:"0"}},{default:o(()=>[t(e,{class:"py-1 px-3","scroll-behavior":"elevate",density:"compact"},{prepend:o(()=>[t(ve),u("h3",Ce,w(p.$route.meta.titulo),1)]),append:o(()=>[t(pe,{class:"ml-4",style:{"max-width":"300px"},onValor:g[0]||(g[0]=n=>O.value=n)}),t(M)]),_:1}),r(v).loadVisitas?(c(),_(N,{key:0,class:"mt-2",height:"2",indeterminate:""})):b("",!0),r(v).visitas<=0?F((c(),_(L,{key:1,class:"mx-2 my-4",dense:""},{default:o(()=>[$e]),_:1},512)),[[H,!r(v).loadVisitas]]):(c(),_(L,{key:2,class:"mx-2 my-4",dense:""},{default:o(()=>[(c(!0),$(Z,null,G(r(v).visitas,n=>F((c(),_(D,{key:n.idVisita,cols:"12",xxl:"2",xl:"3",lg:"4",md:"6",sm:"12",xs:"12"},{default:o(()=>[t(l,{color:n.concluido?"var(--primary-color)":null,class:"card-visita",rounded:"lg",variant:n.concluido?"tonal":"flat",elevation:"2"},{default:o(()=>[t(z,null,{default:o(()=>[t(y,{class:"text-body-2 align-center"},{default:o(()=>[t(T,{color:"var(--primary-color)",icon:"mdi-calendar",start:""}),u("span",Se,w(x(n.data)),1),t(h)]),_:2},1024),u("div",Ne,[u("div",Ae,w(n.nomeAnimal),1),u("div",De,[Oe,S(" "+w(n.nomeCliente),1)])])]),_:2},1024),t(R),u("div",Le,[t(B,{class:"text-medium-emphasis",color:"var(--primary-color)",size:"small",variant:"tonal"},{default:o(()=>[t(T,{class:"mr-1"},{default:o(()=>[S("mdi-toolbox")]),_:1}),S(" "+w(n.servicos.length),1)]),_:2},1024),t(h),!n.concluido&&r(v).userLogado.type==="user"?(c(),_(I,{key:0,onClick:m=>{n.concluido=!0,r(v).atualizarVisita(n,null,!1)},class:"text-none border mr-2",color:"var(--primary-color)","prepend-icon":"mdi-check",variant:"text"},{default:o(()=>[S("Concluir")]),_:2},1032,["onClick"])):b("",!0),r(v).loadVisitas?b("",!0):(c(),_(i,{key:1,location:"left top","close-on-content-click":!1},{activator:o(({props:m})=>[t(I,re({icon:"mdi-dots-horizontal",density:"comfortable"},m,{variant:"text",class:"border",style:{"border-radius":"4px"}}),null,16)]),default:o(()=>[t(P,{class:"mr-2",style:{width:"150px",padding:"0"}},{default:o(()=>[t(M,{edit:!0,id:n.idVisita},null,8,["id"]),n.concluido&&r(v).userLogado.type==="user"?(c(),_(A,{key:0,density:"compact","prepend-icon":"mdi-alert-circle-outline",variant:"tonal",color:"yellow",active:"",onClick:m=>{n.concluido=!1,r(v).atualizarVisita(n,null,!1)}},{default:o(()=>[Te]),_:2},1032,["onClick"])):b("",!0),r(v).userLogado.type==="user"||r(v).userLogado.type==="client"&&!n.concluido?(c(),_(A,{key:1,density:"compact","prepend-icon":"mdi-trash-can",variant:"tonal",color:"red",active:"",onClick:m=>r(v).deletarVisita({idVisita:n.idVisita})},{default:o(()=>[ze]),_:2},1032,["onClick"])):b("",!0)]),_:2},1024)]),_:2},1024))])]),_:2},1032,["color","variant"])]),_:2},1024)),[[H,!r(v).loadVisitas]])),128))]),_:1})),t(l,{elevation:"0",style:{"border-radius":"0"}})]),_:1})}}},Be=ne(Ie,[["__scopeId","data-v-ee03c435"]]);export{Be as default};
